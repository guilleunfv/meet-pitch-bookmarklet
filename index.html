<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Asistente de Pitch para Meet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css " />
    <style>
        /* ... (estilos existentes) ... */
    </style>
</head>
<body>

<div class="container">
    <h1>Asistente de Pitch para Google Meet</h1>
    <p>Arrastra el siguiente botón a tu barra de marcadores para instalar el asistente de pitch.</p>
    <p><strong>Este bookmarklet cargará automáticamente el contenido desde el archivo <code>pitch.txt</code>.</strong></p>

    <a id="installBookmarklet" class="bookmarklet-link" href="#" aria-label="Instalar Bookmarklet: Asistente de Pitch">
        <i class="fas fa-bookmark"></i> Arrastrar: Pitch Meet
    </a>

    <div class="important-note">
        <p><strong>Nota:</strong> Si actualizas el archivo <code>pitch.txt</code>, el cambio se reflejará la próxima vez que uses el bookmarklet.</p>
    </div>

    <h2>¿Cómo funciona?</h2>
    <ul>
        <li><i class="fas fa-sync-alt"></i> Carga siempre el contenido más reciente del archivo <code>pitch.txt</code>.</li>
        <li><i class="fas fa-eye"></i> Se muestra en un recuadro dentro de tu ventana de Google Meet.</li>
        <li><i class="fas fa-times-circle"></i> Puedes ocultar/mostrar el recuadro haciendo clic en el botón o usando la 'X'.</li>
    </ul>
</div>

<!-- Cuadro de Pitch -->
<div class="pitch-box" id="myMeetPitchFromRepo" role="dialog" aria-labelledby="pitchTitle">
    <button class="close-button" aria-label="Cerrar pitch">×</button>
    <div id="pitchContent">Cargando contenido...</div>
</div>

<script>
    // Configuración
    const GITHUB_USER = 'guilleunfv';
    const REPO_NAME = 'meet-pitch-bookmarklet';
    const PITCH_FILE_PATH = 'pitch.txt';

    // Usamos GitHub Pages para evitar problemas de CORS
    const pitchFileUrl = `https://guilleunfv.github.io/meet-pitch-bookmarklet/pitch.txt `;

    const bookmarkletCode = `javascript:(async function() {
        const PITCH_TEXT_URL = '${pitchFileUrl}';
        const pitchBox = document.getElementById('myMeetPitchFromRepo');
        const pitchContent = document.getElementById('pitchContent');

        if (!pitchBox) {
            console.error('No se encontró el contenedor del pitch.');
            return;
        }

        if (pitchBox.style.display === 'block') {
            pitchBox.style.display = 'none';
            return;
        }

        pitchContent.textContent = 'Cargando...';
        pitchBox.style.display = 'block';

        try {
            const response = await fetch(PITCH_TEXT_URL + '?cache=' + new Date().getTime());
            if (!response.ok) throw new Error('Error al cargar el archivo.');

            const texto = await response.text();
            pitchContent.textContent = texto;

        } catch (error) {
            console.error('Error al cargar el pitch:', error);
            pitchContent.innerHTML = '<span style="color:red;">⚠️ No se pudo cargar el contenido: ' + error.message + '</span>';
        }
    })();`;

    // Asignamos el bookmarklet al link
    document.getElementById('installBookmarklet').setAttribute('href', bookmarkletCode);

    // Botón de cerrar
    document.querySelector('.close-button').onclick = function () {
        document.getElementById('myMeetPitchFromRepo').style.display = 'none';
    };
</script>

</body>
</html>
